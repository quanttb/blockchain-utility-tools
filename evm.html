<!DOCTYPE html>
<html>
    <head>
        <title>EVM Utility Tools</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.21.7/css/uikit.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.21.7/js/uikit.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.21.7/js/uikit-icons.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.10.0/web3.min.js"></script>
    </head>
    <body>
        <a href="https://github.com/quanttb/blockchain-utility-tools" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
        <h1 class="uk-heading-line uk-text-center uk-margin-top">EVM Utility Tools</h1>
        <div class="uk-margin-small-left uk-margin-small-right">
            <div uk-grid>
                <div class="uk-width-expand@m">
                    <input id="rpc" class="uk-input" type="text" placeholder="RPC">
                </div>
                <div>
                    <button class="uk-button uk-button-default">Choose</button>
                    <div class="uk-dropdown-small" uk-dropdown>
                        <ul class="uk-nav uk-dropdown-nav">
                            <li><a href="#" onclick="setRpc('BSC')">Binance Smart Chain</a></li>
                            <li><a href="#" onclick="setRpc('ETH')">Ethereum</a></li>
                            <li><a href="#" onclick="setRpc('POLYGON')">Polygon</a></li>
                            <li><a href="#" onclick="setRpc('AVAX')">Avalanche</a></li>
                            <li class="uk-nav-divider"></li>
                            <li><a href="#" onclick="setRpc('BSC_TESTNET')">BSC Testnet</a></li>
                            <li><a href="#" onclick="setRpc('SEPOLIA')">Sepolia</a></li>
                            <li><a href="#" onclick="setRpc('AMOY')">Amoy</a></li>
                            <li><a href="#" onclick="setRpc('FUJI')">Fuji</a></li>
                        </ul>
                    </div>
                </div>
                <div>
                    <button onclick="connectToMetamask()" class="uk-button uk-button-primary" disabled>Connect to Metamask</button>
                </div>
            </div>
            <ul class="uk-flex-left" uk-tab>
                <li><a href="#">Get Transaction</a></li>
                <li class="uk-active"><a href="#">Generate new Account</a></li>
                <li><a href="#">Check RPC</a></li>
                <li><a href="#">Interact with Smart Contract</a></li>
                <li><a href="#">Decode Input Data</a></li>
                <li><a href="#">Use web3.js</a></li>
            </ul>
            <div class="uk-switcher uk-margin">
                <div>
                    <input id="hash-1" class="uk-input uk-margin-small-top" type="text" placeholder="Hash">
                    <button onclick="getTransaction()" class="uk-button uk-button-primary uk-margin-top">Get Transaction</button>
                    <button onclick="getTransactionReceipt()" class="uk-button uk-button-primary uk-margin-top">Get Transaction Receipt</button>
                    <textarea id="result-1" class="uk-textarea uk-margin-top" rows="20" disabled></textarea>
                </div>
                <div>
                    <button onclick="generateNewAccount()" class="uk-button uk-button-primary uk-margin-top">Generate new Account</button>
                    <button onclick="generateMnemonic()" class="uk-button uk-button-primary uk-margin-top">Generate Mnemonic</button>
                    <textarea id="result-2" class="uk-textarea uk-margin-top" rows="20" disabled></textarea>
                </div>
                <div>
                    <button onclick="getLatestBlock()" class="uk-button uk-button-primary uk-margin-top">Get Latest Block</button>
                    <button onclick="getChainId()" class="uk-button uk-button-primary uk-margin-top">Get Chain ID</button>
                    <textarea id="result-3" class="uk-textarea uk-margin-top" rows="20" disabled></textarea>
                </div>
                <div>
                    <input id="contract-4" class="uk-input uk-margin-small-top" type="text" placeholder="Contract Address">
                    <textarea id="abi-4" class="uk-textarea uk-margin-top" rows="5" placeholder="ABI"></textarea>
                    <button onclick="generateFunctions()" class="uk-button uk-button-primary uk-margin-top">Generate Functions</button>
                    <div class="uk-margin-top">
                        <ul id="read-buttons-4" uk-accordion></ul>
                        <ul id="write-buttons-4" uk-accordion></ul>
                    </div>
                    <textarea id="result-4" class="uk-textarea" rows="20" disabled></textarea>
                </div>
                <div>
                    <input id="input-5" class="uk-input uk-margin-small-top" type="text" placeholder="Input Data">
                    <textarea id="abi-5" class="uk-textarea uk-margin-top" rows="5" placeholder="ABI"></textarea>
                    <button onclick="decode()" class="uk-button uk-button-primary uk-margin-top">Decode</button>
                    <textarea id="result-5" class="uk-textarea uk-margin-top" rows="20" disabled></textarea>
                </div>
                <div>
                    <input id="function-6" class="uk-input uk-margin-small-top" type="text" placeholder="Function">
                    <button onclick="execute()" class="uk-button uk-button-primary uk-margin-top">Execute</button>
                    <textarea id="result-6" class="uk-textarea uk-margin-top" rows="20" disabled></textarea>
                </div>
            </div>
        </div>
        <script src="js/bip39.js"></script>
        <script src="js/hdkey.js"></script>
        <script>
            BigInt.prototype.toJSON = function() { return this.toString() };

            async function setRpc(network) {
                let rpc;
                switch (network) {
                    case 'BSC':
                        rpc = 'https://bsc-dataseed.binance.org/';
                        break;
                    case 'ETH':
                        rpc = 'https://rpc.ankr.com/eth';
                        UIkit.notification({message: "<span uk-icon=\'icon: warning\'></span> Endpoint's rate limit is capped on Public.", status: 'warning'});
                        break;
                    case 'POLYGON':
                        rpc = 'https://polygon-rpc.com';
                        break;
                    case 'AVAX':
                        rpc = 'https://api.avax.network/ext/bc/C/rpc';
                        break;
                    case 'BSC_TESTNET':
                        rpc = 'https://data-seed-prebsc-1-s1.binance.org:8545/';
                        break;
                    case 'SEPOLIA':
                        rpc = 'https://rpc.ankr.com/eth_sepolia';
                        UIkit.notification({message: "<span uk-icon=\'icon: warning\'></span> Endpoint's rate limit is capped on Public.", status: 'warning'});
                        break;
                    case 'AMOY':
                        rpc = 'https://rpc-amoy.polygon.technology/';
                        break;
                    case 'FUJI':
                        rpc = 'https://43113.rpc.thirdweb.com';
                        break;
                }
                document.getElementById('rpc').value = rpc;
            }

            async function connectToMetamask() {}

            async function getTransaction() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const tx = await web3.eth.getTransaction(document.getElementById('hash-1').value);
                    document.getElementById('result-1').value = JSON.stringify(tx, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-1').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function getTransactionReceipt() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const tx = await web3.eth.getTransactionReceipt(document.getElementById('hash-1').value);
                    document.getElementById('result-1').value = JSON.stringify(tx, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-1').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function generateNewAccount() {
                try {
                    const web3 = new Web3();
                    const account = await web3.eth.accounts.create();
                    document.getElementById('result-2').value = JSON.stringify(account, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-2').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function generateMnemonic(numberOfAccounts = 10) {
                try {
                    const web3 = new Web3();
                    const mnemonic = bip39.generateMnemonic();
                    const seed = bip39.mnemonicToSeedSync(mnemonic);
                    const root = HDKey.fromMasterSeed(seed);
                    const accounts = [];

                    for (let i = 0; i < numberOfAccounts; i++) {
                        const path = `m/44'/60'/0'/0/${i}`;
                        const wallet = root.derive(path);
                        const privateKey = `0x${wallet.privateKey.toString('hex')}`;
                        const account = web3.eth.accounts.privateKeyToAccount(privateKey);

                        accounts.push({ address: account.address, privateKey });
                    }

                    const result = { mnemonic, accounts };

                    document.getElementById('result-2').value = JSON.stringify(result, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-2').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function getLatestBlock() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const block = await web3.eth.getBlock('latest');
                    document.getElementById('result-3').value = JSON.stringify(block, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-3').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function getChainId() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const chainId = await web3.eth.getChainId();
                    document.getElementById('result-3').value = chainId;
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-3').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function generateFunctions() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const functions = JSON.parse(document.getElementById('abi-4').value);
                    const readFunctions = [];
                    const writeFunctions = [];
                    functions.forEach(f => {
                        if (f.type === 'function') {
                            if (f.constant) {
                                if (f.inputs.length) {
                                    const inputs = [];
                                    const args = [];
                                    const types = [];

                                    f.inputs.forEach(i => {
                                        inputs.push(`<input id="${f.name}-${i.name}" class="uk-input uk-margin-small-bottom" type="text" placeholder="${i.name} (${i.type})">`);
                                        args.push(i.name);
                                        types.push(i.type);
                                    });

                                    readFunctions.push(`
                                        <li>
                                            <a class="uk-accordion-title uk-text-success" href>${f.name}(${types.join()})</a>
                                            <div class="uk-accordion-content">
                                                ${inputs.join('')}
                                                <button onclick="read('${f.name}',['${args.join("','")}'])" class="uk-button uk-button-default">Query</button><br/>
                                            </div>
                                        </li>
                                    `);
                                } else {
                                    readFunctions.push(`
                                        <li>
                                            <a class="uk-accordion-title uk-text-success" href>${f.name}</a>
                                            <div class="uk-accordion-content">
                                                <button onclick="read('${f.name}',[])" class="uk-button uk-button-default">Query</button><br/>
                                            </div>
                                        </li>
                                    `);
                                }
                            } else {
                                if (f.inputs.length) {
                                    const inputs = [`<input id="${f.name}-sender" class="uk-input uk-margin-small-bottom" type="text" placeholder="sender">`];
                                    const args = [];
                                    const types = [];

                                    f.inputs.forEach(i => {
                                        inputs.push(`<input id="${f.name}-${i.name}" class="uk-input uk-margin-small-bottom" type="text" placeholder="${i.name} (${i.type})">`);
                                        args.push(i.name);
                                        types.push(i.type);
                                    });

                                    writeFunctions.push(`
                                        <li>
                                            <a class="uk-accordion-title uk-text-warning" href>${f.name}(${types.join()})</a>
                                            <div class="uk-accordion-content">
                                                ${inputs.join('')}
                                                <button onclick="encode('${f.name}',['${args.join("','")}'])" class="uk-button uk-button-default">ENCODE</button>
                                                <button onclick="simulate('${f.name}',['${args.join("','")}'])" class="uk-button uk-button-default">Simulate</button>
                                                <button onclick="write('${f.name}',['${args.join("','")}'])" class="uk-button uk-button-default" disabled>Write</button><br/>
                                            </div>
                                        </li>
                                    `);
                                } else {
                                    writeFunctions.push(`
                                        <li>
                                            <a class="uk-accordion-title uk-text-warning" href>${f.name}</a>
                                            <div class="uk-accordion-content">
                                                <input id="${f.name}-sender" class="uk-input uk-margin-small-bottom" type="text" placeholder="sender">
                                                <button onclick="encode('${f.name}',[])" class="uk-button uk-button-default">Encode</button>
                                                <button onclick="simulate('${f.name}',[])" class="uk-button uk-button-default">Simulate</button>
                                                <button onclick="write('${f.name}',[])" class="uk-button uk-button-default" disabled>Write</button><br/>
                                            </div>
                                        </li>
                                    `);
                                }
                            }
                        }
                    });
                    document.getElementById('read-buttons-4').innerHTML = readFunctions.join('');
                    document.getElementById('write-buttons-4').innerHTML = writeFunctions.join('');
                } catch (err) {
                    document.getElementById('result-4').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function read(functionName, args) {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const contract = new web3.eth.Contract(
                        JSON.parse(document.getElementById('abi-4').value),
                        document.getElementById('contract-4').value
                    );
                    let result;
                    if (args.length) {
                        args = args.map(arg => document.getElementById(`${functionName}-${arg}`).value);
                        result = await contract.methods[functionName](...args).call();
                    } else {
                        result = await contract.methods[functionName]().call();
                    }
                    document.getElementById('result-4').value = result;
                    UIkit.scroll(`#result-4`).scrollTo('#result-4');
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-4').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function encode(functionName, args) {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const contract = new web3.eth.Contract(
                        JSON.parse(document.getElementById('abi-4').value),
                        document.getElementById('contract-4').value
                    );
                    let result;
                    if (args.length) {
                        args = args.map(arg => document.getElementById(`${functionName}-${arg}`).value);
                        result = await contract.methods[functionName](...args).encodeABI();
                    } else {
                        result = await contract.methods[functionName]().encodeABI();
                    }
                    document.getElementById('result-4').value = result;
                    UIkit.scroll(`#result-4`).scrollTo('#result-4');
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-4').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function simulate(functionName, args) {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const contract = new web3.eth.Contract(
                        JSON.parse(document.getElementById('abi-4').value),
                        document.getElementById('contract-4').value
                    );
                    let method;
                    if (args.length) {
                        args = args.map(arg => document.getElementById(`${functionName}-${arg}`).value);
                        method = await contract.methods[functionName](...args);
                    } else {
                        method = await contract.methods[functionName]();
                    }
                    try {
                        await web3.eth.call({
                            from: document.getElementById(`${functionName}-sender`).value,
                            to: document.getElementById('contract-4').value,
                            data: method.encodeABI(),
                        });
                        document.getElementById('result-4').value = 'OK';
                        UIkit.scroll(`#result-4`).scrollTo('#result-4');
                        UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                    } catch (err) {
                        if (err.data) {
                            const result = err.data.startsWith('0x') ? err.data : `0x${err.data}`;
                            const reason = web3.utils.toAscii(`0x${result.substr(138)}`);
                            document.getElementById('result-4').value = `Revert: ${reason}`;
                        } else if (err?.cause.message) {
                            document.getElementById('result-4').value = `Revert: ${err.cause.message}`;
                        } else {
                            document.getElementById('result-4').value = 'Revert';
                            console.log(err);
                        }
                        UIkit.scroll(`#result-4`).scrollTo('#result-4');
                        UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> revert', status: 'danger'});
                    }
                } catch (err) {
                    document.getElementById('result-4').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function decode() {
                try {
                    const web3 = new Web3();
                    const functions = JSON.parse(document.getElementById('abi-4').value);
                    const inputData = document.getElementById('input-5').value;
                    let found;
                    functions.forEach(f => {
                        if (f.type === 'function' && web3.eth.abi.encodeFunctionSignature(f) === inputData.substring(0, 10)) {
                            found = f;
                        }
                    });
                    if (found) {
                        const result = web3.eth.abi.decodeParameters(found.inputs, `0x${inputData.slice(10 - inputData.length)}`);
                        document.getElementById('result-5').value = JSON.stringify(result, null, 5);
                        UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                    } else {
                        document.getElementById('result-5').value = 'No matching function found';
                        UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                    }
                } catch (err) {
                    document.getElementById('result-5').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }

            async function execute() {
                try {
                    const web3 = new Web3(document.getElementById('rpc').value);
                    const result = await eval(document.getElementById('function-6').value);
                    document.getElementById('result-6').value = JSON.stringify(result, null, 5);
                    UIkit.notification({message: '<span uk-icon=\'icon: check\'></span> success', status: 'success'});
                } catch (err) {
                    document.getElementById('result-6').value = err.message;
                    UIkit.notification({message: '<span uk-icon=\'icon: close\'></span> error', status: 'danger'});
                }
            }
        </script>
    </body>
</html>